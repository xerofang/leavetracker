<%- include('../layouts/main', {
  extraHead: `
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css" rel="stylesheet">
  `,
  body: `
<div class="d-flex justify-content-between align-items-center mb-4">
  <h2><i class="bi bi-calendar3"></i> Team Calendar</h2>
  <div>
    <select class="form-select form-select-sm d-inline-block w-auto" id="employeeFilter">
      <option value="">All Employees</option>
      ${employees.map(e => `<option value="${e.id}">${e.first_name} ${e.last_name}</option>`).join('')}
    </select>
  </div>
</div>

<div class="card shadow-sm">
  <div class="card-body">
    <div class="mb-3">
      <span class="badge bg-success me-2">● Approved</span>
      <span class="badge bg-warning text-dark">● Pending</span>
    </div>
    <div id="calendar"></div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const calendarEl = document.getElementById('calendar');
  const calendar = new FullCalendar.Calendar(calendarEl, {
    initialView: 'dayGridMonth',
    headerToolbar: {
      left: 'prev,next today',
      center: 'title',
      right: 'dayGridMonth,dayGridWeek,listWeek'
    },
    events: function(info, successCallback, failureCallback) {
      const employeeId = document.getElementById('employeeFilter').value;
      let url = '/admin/api/calendar?start=' + info.startStr + '&end=' + info.endStr;
      if (employeeId) url += '&employee_id=' + employeeId;

      fetch(url)
        .then(response => response.json())
        .then(data => successCallback(data))
        .catch(error => failureCallback(error));
    },
    eventClick: function(info) {
      const props = info.event.extendedProps;
      alert(props.employee + '\\n' + props.leaveType + ' (' + props.days + ' days)\\nStatus: ' + props.status);
    }
  });
  calendar.render();

  document.getElementById('employeeFilter').addEventListener('change', function() {
    calendar.refetchEvents();
  });
});
</script>
` }) %>
