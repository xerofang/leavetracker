<%- include('../layouts/main', { body: `
<div class="d-flex justify-content-between align-items-center mb-4">
  <h2><i class="bi bi-clock-history"></i> Leave History</h2>
  <div>
    <select class="form-select form-select-sm d-inline-block w-auto" onchange="window.location.href='/employee/history?year='+this.value">
      <option value="${currentYear}" ${year == currentYear ? 'selected' : ''}>${currentYear}</option>
      <option value="${currentYear - 1}" ${year == currentYear - 1 ? 'selected' : ''}>${currentYear - 1}</option>
    </select>
    <a href="/employee/apply" class="btn btn-primary btn-sm ms-2">
      <i class="bi bi-plus-circle"></i> New Request
    </a>
  </div>
</div>

<div class="card shadow-sm">
  <div class="card-body p-0">
    ${requests.length > 0 ? `
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead class="table-light">
            <tr>
              <th>Leave Type</th>
              <th>From</th>
              <th>To</th>
              <th>Days</th>
              <th>Reason</th>
              <th>Status</th>
              <th>Remarks</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            ${requests.map(r => `
              <tr>
                <td><span class="badge bg-primary">${r.leaveType.name}</span></td>
                <td>${formatDate(r.start_date)}</td>
                <td>${formatDate(r.end_date)}</td>
                <td>${r.total_days}</td>
                <td>${r.reason ? (r.reason.length > 30 ? r.reason.substring(0, 30) + '...' : r.reason) : '-'}</td>
                <td>
                  <span class="badge bg-${r.status === 'approved' ? 'success' : r.status === 'rejected' ? 'danger' : r.status === 'cancelled' ? 'secondary' : 'warning'}">
                    ${r.status.charAt(0).toUpperCase() + r.status.slice(1)}
                  </span>
                </td>
                <td>${r.admin_remarks || '-'}</td>
                <td>
                  ${r.status === 'pending' ? `
                    <form method="POST" action="/employee/cancel/${r.id}" class="d-inline" onsubmit="return confirm('Cancel this request?')">
                      <button type="submit" class="btn btn-sm btn-outline-danger">
                        <i class="bi bi-x-lg"></i> Cancel
                      </button>
                    </form>
                  ` : ''}
                </td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      </div>
    ` : `
      <div class="text-center py-5 text-muted">
        <i class="bi bi-inbox" style="font-size: 3rem;"></i>
        <p class="mt-2">No leave requests found for ${year}</p>
        <a href="/employee/apply" class="btn btn-primary btn-sm">Apply for Leave</a>
      </div>
    `}
  </div>
</div>
` }) %>
